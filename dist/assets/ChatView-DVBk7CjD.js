import{a1 as x,c as d,o as i,a as g,a2 as L,a3 as I,a4 as b,a5 as V,_ as C,a6 as f,a7 as k,a8 as R,a9 as $,aa as B,ab as T,ac as S,ad as z,ae as A,af as N,ag as D,b as H,ah as M,ai as F,aj as O,ak as P,al as U}from"./index-JhO8GmO2.js";const E=200,j=m=>{const{containerRef:s,inputRef:e,inputHeight:c,onHeightUpdate:r}=m;let l=null,u=!1,v=window.innerHeight,t=null,o=null,p=null;const n=()=>{e.value&&(c.value=e.value.offsetHeight,s.value&&(s.value.style.paddingBottom=`${c.value}px`),r==null||r())},a=()=>{const y=window.innerHeight;u=v-y>150,o&&clearTimeout(o),o=setTimeout(()=>{n(),o=null},E)},_=y=>{if(!u||!e.value)return;const h=y.target;if(!(e.value.contains(h)||h.closest("textarea")!==null||h.closest("input")!==null||h.tagName==="TEXTAREA"||h.tagName==="INPUT")){const w=document.activeElement;w&&(w.tagName==="TEXTAREA"||w.tagName==="INPUT")&&w.blur()}};return e.value&&(n(),v=window.innerHeight,l=new ResizeObserver(n),l.observe(e.value),window.visualViewport?(window.visualViewport.addEventListener("resize",a),window.visualViewport.addEventListener("scroll",a)):(window.addEventListener("resize",a),t=()=>{p&&clearTimeout(p),p=setTimeout(()=>{v=window.innerHeight,a(),p=null},E)},window.addEventListener("orientationchange",t)),document.addEventListener("touchstart",_,{passive:!0})),()=>{o&&(clearTimeout(o),o=null),p&&(clearTimeout(p),p=null),l&&(l.disconnect(),l=null),window.visualViewport?(window.visualViewport.removeEventListener("resize",a),window.visualViewport.removeEventListener("scroll",a)):(window.removeEventListener("resize",a),t&&(window.removeEventListener("orientationchange",t),t=null)),document.removeEventListener("touchstart",_)}},W={class:"user-message-box flex items-center justify-end"},X={class:"user-message border-[1.5px] border-black max-w-[80%] py-2.5 px-3.5 rounded-[8px_0_8px_8px] bg-white"},K=x({__name:"User",props:{msg:{}},setup(m){const s=m;return(e,c)=>(i(),d("div",W,[g("div",X,[s.msg.type==="text"?(i(),d("div",{key:0,class:b(["msg-"+s.msg.type])},V(s.msg.text),3)):I("",!0)]),L(e.$slots,"timeBox")]))}}),Y={class:"agent-message-box flex"},q=["innerHTML"],G={key:1},J=["innerHTML"],Q={key:2},Z=["innerHTML"],ee=x({__name:"Agent",props:{msg:{}},setup(m){const s=m,e=`msg-${s.msg.type}`;return(c,r)=>(i(),d("div",Y,[g("div",{class:b(["agent-message max-w-[80%] py-2.5 px-3.5 rounded-[0px_8px_8px_8px] bg-[#FFCF73]",e])},[s.msg.type==="text"?(i(),d("div",{key:0,innerHTML:s.msg.text},null,8,q)):s.msg.type==="command"?(i(),d("div",G,[g("div",{class:"command-message",innerHTML:s.msg.text},null,8,J)])):s.msg.type==="status"?(i(),d("div",Q,[g("div",{class:"status-message",innerHTML:s.msg.text},null,8,Z)])):I("",!0)]),L(c.$slots,"timeBox",{},void 0,!0)]))}}),te=C(ee,[["__scopeId","data-v-0752d804"]]),se={class:"chat-window"},ne=x({__name:"Index",props:{messages:{}},setup(m){const s=m,e=f(null),c=f(!0);k(()=>s.messages,()=>{r()},{deep:!0,immediate:!0});function r(){S(()=>{e.value&&c.value&&(e.value.scrollTop=e.value.scrollHeight)})}function l(){if(!e.value)return;const u=e.value,v=20,t=u.scrollHeight-u.scrollTop-u.clientHeight;c.value=t<=v}return R(()=>{e.value&&e.value.addEventListener("scroll",l)}),(u,v)=>(i(),d("div",{class:"chat-messages",ref_key:"chatBox",ref:e,onScroll:l},[g("div",se,[(i(!0),d($,null,B(m.messages,(t,o)=>(i(),d("div",{class:b(["message",t.sender,t.type,t.msgStyle]),key:o},[t.sender==="user"?(i(),T(K,{key:0,msg:t},null,8,["msg"])):(i(),T(te,{key:1,msg:t},null,8,["msg"]))],2))),128))])],544))}}),ae=C(ne,[["__scopeId","data-v-b2e6122a"]]),oe={class:"h-full overflow-y-auto bg-[url('@/assets/imgs/chat/bg.png')] bg-no-repeat bg-center bg-[#fffefa] bg-size-[100%_auto] container mx-auto lg:max-w-3xl"},ie={class:"p-4 flex flex-col flex-1 overflow-hidden"},re={class:"container mx-auto p-4 lg:max-w-3xl"},ue=x({__name:"ChatView",setup(m){const s=z(),e=f([]),c=N(),r=A(()=>c.params.chatId);k(()=>s.ChatHistoryList.find(n=>n.chatId===r.value),async n=>{n&&(e.value=await O(r.value))},{deep:!0,immediate:!0});const l=f(null),u=f(null),v=f(96);let t=null;R(()=>{t=j({containerRef:l,inputRef:u,inputHeight:v})}),D(()=>{t&&(t(),t=null)});const o=async(n,a)=>{await U({messageObj:n,chatId:a})},p=async n=>{const a=r.value;o({text:n,sender:"user",type:"text",timeStamp:Date.now()},a);const _=await P({message:n,chatId:r.value});o({text:_,sender:"agent",type:"text",timeStamp:Date.now()},a)};return(n,a)=>(i(),d("div",oe,[g("div",{ref_key:"containerRef",ref:l,class:"flex flex-col flex-1"},[g("div",ie,[H(ae,{messages:M(e)},null,8,["messages"])]),g("div",{ref_key:"inputRef",ref:u,class:"fixed bottom-0 left-10 right-10 z-10 bg-white border-t border-gray-200 pb-[env(safe-area-inset-bottom,0)] lg:border-none"},[g("div",re,[H(F,{onSubmit:p})])],512)],512)]))}});export{ue as default};
