import{a1 as h,c as n,o as a,a as r,a2 as y,a3 as b,a4 as x,a5 as I,_ as w,a6 as u,a7 as k,a8 as C,a9 as S,aa as $,ab as f,ac as B,ad as L,ae as M,af as R,ag as V,ah as F,b as v,ai as z,aj as A,ak as D,al as N,am as j}from"./index-BZ66Af0Q.js";const E={class:"user-message-box flex items-center justify-end"},U={class:"user-message border-[1.5px] border-black max-w-[80%] py-2.5 px-3.5 rounded-[8px_0_8px_8px] bg-white"},W=h({__name:"User",props:{msg:{}},setup(c){const e=c;return(t,l)=>(a(),n("div",E,[r("div",U,[e.msg.type==="text"?(a(),n("div",{key:0,class:x(["msg-"+e.msg.type])},I(e.msg.text),3)):b("",!0)]),y(t.$slots,"timeBox")]))}}),q={class:"agent-message-box flex"},G=["innerHTML"],J={key:1},K=["innerHTML"],O={key:2},P=["innerHTML"],Q=h({__name:"Agent",props:{msg:{}},setup(c){const e=c,t=`msg-${e.msg.type}`;return(l,i)=>(a(),n("div",q,[r("div",{class:x(["agent-message max-w-[80%] py-2.5 px-3.5 rounded-[0px_8px_8px_8px] bg-[#FFCF73]",t])},[e.msg.type==="text"?(a(),n("div",{key:0,innerHTML:e.msg.text},null,8,G)):e.msg.type==="command"?(a(),n("div",J,[r("div",{class:"command-message",innerHTML:e.msg.text},null,8,K)])):e.msg.type==="status"?(a(),n("div",O,[r("div",{class:"status-message",innerHTML:e.msg.text},null,8,P)])):b("",!0)]),y(l.$slots,"timeBox",{},void 0,!0)]))}}),X=w(Q,[["__scopeId","data-v-0752d804"]]),Y={class:"chat-window"},Z=h({__name:"Index",props:{messages:{}},setup(c){const e=c,t=u(null),l=u(!0);k(()=>e.messages,()=>{i()},{deep:!0,immediate:!0});function i(){B(()=>{t.value&&l.value&&(t.value.scrollTop=t.value.scrollHeight)})}function m(){if(!t.value)return;const d=t.value,_=20,s=d.scrollHeight-d.scrollTop-d.clientHeight;l.value=s<=_}return C(()=>{t.value&&t.value.addEventListener("scroll",m)}),(d,_)=>(a(),n("div",{class:"chat-messages",ref_key:"chatBox",ref:t,onScroll:m},[r("div",Y,[(a(!0),n(S,null,$(c.messages,(s,g)=>(a(),n("div",{class:x(["message",s.sender,s.type,s.msgStyle]),key:g},[s.sender==="user"?(a(),f(W,{key:0,msg:s},null,8,["msg"])):(a(),f(X,{key:1,msg:s},null,8,["msg"]))],2))),128))])],544))}}),ee=w(Z,[["__scopeId","data-v-b2e6122a"]]),te={class:"h-full overflow-y-auto bg-[url('@/assets/imgs/chat/bg.png')] bg-no-repeat bg-center bg-[#fffefa] bg-size-[100%_auto] container mx-auto lg:max-w-3xl"},se={class:"p-4 flex flex-col flex-1 overflow-hidden"},ae={class:"container mx-auto p-4 lg:max-w-3xl"},oe=h({__name:"ChatView",setup(c){const e=L(),t=u([]),l=R(),i=M(()=>l.params.chatId);k(()=>e.ChatHistoryList.find(o=>o.chatId===i.value),async o=>{o&&(t.value=await D(i.value))},{deep:!0,immediate:!0});const m=u(null),d=u(null),_=u(96);let s=null;C(()=>{s=V({containerRef:m,inputRef:d,inputHeight:_})}),F(()=>{s&&(s(),s=null)});const g=async(o,p)=>{await j({messageObj:o,chatId:p})},H=async o=>{const p=i.value;g({text:o,sender:"user",type:"text",timeStamp:Date.now()},p);const T=await N({message:o,chatId:i.value});g({text:T,sender:"agent",type:"text",timeStamp:Date.now()},p)};return(o,p)=>(a(),n("div",te,[r("div",{ref_key:"containerRef",ref:m,class:"flex flex-col flex-1"},[r("div",se,[v(ee,{messages:z(t)},null,8,["messages"])]),r("div",{ref_key:"inputRef",ref:d,class:"fixed bottom-0 left-10 right-10 z-10 bg-white border-t border-gray-200 pb-[env(safe-area-inset-bottom,0)] lg:border-none"},[r("div",ae,[v(A,{onSubmit:H})])],512)],512)]))}});export{oe as default};
