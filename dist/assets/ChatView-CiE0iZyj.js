import{a1 as y,c as d,o as i,a as g,a2 as I,a3 as C,a4 as T,a5 as S,_ as k,a6 as h,a7 as R,a8 as V,a9 as z,aa as $,ab as E,ac as B,ad as A,ae as N,af as D,ag as M,b as H,ah as P,ai as F,aj as O,ak as U,al as j}from"./index-Bbs1TI2A.js";const W={class:"user-message-box flex items-center justify-end"},X={class:"user-message border-[1.5px] border-black max-w-[80%] py-2.5 px-3.5 rounded-[8px_0_8px_8px] bg-white"},K=y({__name:"User",props:{msg:{}},setup(m){const s=m;return(e,c)=>(i(),d("div",W,[g("div",X,[s.msg.type==="text"?(i(),d("div",{key:0,class:T(["msg-"+s.msg.type])},S(s.msg.text),3)):C("",!0)]),I(e.$slots,"timeBox")]))}}),Y={class:"agent-message-box flex"},q=["innerHTML"],G={key:1},J=["innerHTML"],Q={key:2},Z=["innerHTML"],ee=y({__name:"Agent",props:{msg:{}},setup(m){const s=m,e=`msg-${s.msg.type}`;return(c,r)=>(i(),d("div",Y,[g("div",{class:T(["agent-message max-w-[80%] py-2.5 px-3.5 rounded-[0px_8px_8px_8px] bg-[#FFCF73]",e])},[s.msg.type==="text"?(i(),d("div",{key:0,innerHTML:s.msg.text},null,8,q)):s.msg.type==="command"?(i(),d("div",G,[g("div",{class:"command-message",innerHTML:s.msg.text},null,8,J)])):s.msg.type==="status"?(i(),d("div",Q,[g("div",{class:"status-message",innerHTML:s.msg.text},null,8,Z)])):C("",!0)]),I(c.$slots,"timeBox",{},void 0,!0)]))}}),te=k(ee,[["__scopeId","data-v-0752d804"]]),se={class:"chat-window"},ne=y({__name:"Index",props:{messages:{}},setup(m){const s=m,e=h(null),c=h(!0);R(()=>s.messages,()=>{r()},{deep:!0,immediate:!0});function r(){B(()=>{e.value&&c.value&&(e.value.scrollTop=e.value.scrollHeight)})}function l(){if(!e.value)return;const u=e.value,v=20,t=u.scrollHeight-u.scrollTop-u.clientHeight;c.value=t<=v}return V(()=>{e.value&&e.value.addEventListener("scroll",l)}),(u,v)=>(i(),d("div",{class:"chat-messages",ref_key:"chatBox",ref:e,onScroll:l},[g("div",se,[(i(!0),d(z,null,$(m.messages,(t,o)=>(i(),d("div",{class:T(["message",t.sender,t.type,t.msgStyle]),key:o},[t.sender==="user"?(i(),E(K,{key:0,msg:t},null,8,["msg"])):(i(),E(te,{key:1,msg:t},null,8,["msg"]))],2))),128))])],544))}}),ae=k(ne,[["__scopeId","data-v-b2e6122a"]]),x=/iPad|iPhone|iPod/.test(navigator.userAgent),L=200,oe=m=>{const{containerRef:s,inputRef:e,inputHeight:c,onHeightUpdate:r}=m;let l=null,u=!1,v=window.innerHeight,t=null,o=null,p=null;const a=()=>{e.value&&(c.value=e.value.offsetHeight,s.value&&(s.value.style.paddingBottom=`${c.value}px`),r==null||r())},n=()=>{if(!x){a();return}const b=window.innerHeight;u=v-b>150,o&&clearTimeout(o),o=setTimeout(()=>{a(),o=null},L)},_=b=>{if(!x||!u||!e.value)return;const f=b.target;if(!(e.value.contains(f)||f.closest("textarea")!==null||f.closest("input")!==null||f.tagName==="TEXTAREA"||f.tagName==="INPUT")){const w=document.activeElement;w&&(w.tagName==="TEXTAREA"||w.tagName==="INPUT")&&w.blur()}};return e.value&&(a(),v=window.innerHeight,l=new ResizeObserver(a),l.observe(e.value),x?(window.visualViewport?(window.visualViewport.addEventListener("resize",n),window.visualViewport.addEventListener("scroll",n)):(window.addEventListener("resize",n),t=()=>{p&&clearTimeout(p),p=setTimeout(()=>{v=window.innerHeight,n(),p=null},L)},window.addEventListener("orientationchange",t)),document.addEventListener("touchstart",_,{passive:!0})):window.addEventListener("resize",n)),()=>{o&&(clearTimeout(o),o=null),p&&(clearTimeout(p),p=null),l&&(l.disconnect(),l=null),x?(window.visualViewport?(window.visualViewport.removeEventListener("resize",n),window.visualViewport.removeEventListener("scroll",n)):(window.removeEventListener("resize",n),t&&(window.removeEventListener("orientationchange",t),t=null)),document.removeEventListener("touchstart",_)):window.removeEventListener("resize",n)}},ie={class:"h-full overflow-y-auto bg-[url('@/assets/imgs/chat/bg.png')] bg-no-repeat bg-center bg-[#fffefa] bg-size-[100%_auto] container mx-auto lg:max-w-3xl"},re={class:"p-4 flex flex-col flex-1 overflow-hidden"},le={class:"container mx-auto p-4 lg:max-w-3xl"},de=y({__name:"ChatView",setup(m){const s=A(),e=h([]),c=D(),r=N(()=>c.params.chatId);R(()=>s.ChatHistoryList.find(a=>a.chatId===r.value),async a=>{a&&(e.value=await O(r.value))},{deep:!0,immediate:!0});const l=h(null),u=h(null),v=h(96);let t=null;V(()=>{t=oe({containerRef:l,inputRef:u,inputHeight:v})}),M(()=>{t&&(t(),t=null)});const o=async(a,n)=>{await j({messageObj:a,chatId:n})},p=async a=>{const n=r.value;o({text:a,sender:"user",type:"text",timeStamp:Date.now()},n);const _=await U({message:a,chatId:r.value});o({text:_,sender:"agent",type:"text",timeStamp:Date.now()},n)};return(a,n)=>(i(),d("div",ie,[g("div",{ref_key:"containerRef",ref:l,class:"flex flex-col flex-1"},[g("div",re,[H(ae,{messages:P(e)},null,8,["messages"])]),g("div",{ref_key:"inputRef",ref:u,class:"fixed bottom-0 left-0 right-0 z-10 bg-white border-t border-gray-200 pb-[env(safe-area-inset-bottom,0)] lg:border-none"},[g("div",le,[H(F,{onSubmit:p})])],512)],512)]))}});export{de as default};
